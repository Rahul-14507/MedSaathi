<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedSaathi Intelligence</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/style.css">
    <!-- Chart.js for Trends -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Marked for Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- JsBarcode for Admission reports -->
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="brand">
                <i class="fa-solid fa-heart-pulse logo-icon"></i>
                <h2>MedSaathi</h2>
            </div>

            <ul class="nav-links">
                <li id="nav-analyze" class="active"><i class="fa-solid fa-file-medical"></i> Analyze Report</li>
                <li id="nav-prescription"><i class="fa-solid fa-pen-to-square"></i> Parse Prescription</li>
                <li id="nav-trends" class="hidden"><i class="fa-solid fa-chart-line"></i> Health Trends</li>
                <li id="nav-followup" class="hidden"><i class="fa-solid fa-user-nurse"></i> Follow-up Dashboard</li>
                <li id="nav-history"><i class="fa-solid fa-clock-rotate-left"></i> History</li>
                <li id="nav-settings"><i class="fa-solid fa-gear"></i> Settings</li>
                <hr style="border: 0; border-top: 1px solid var(--border-color); margin: 0.5rem 0;" />
                <li id="nav-portal" style="color: var(--primary-color); font-weight: 500;"><i
                        class="fa-solid fa-hospital"></i> Enter Staff Portal</li>
            </ul>

            <div class="system-status"
                style="flex-direction: column; align-items: flex-start; gap: 0.5rem; background: transparent; padding: 0;">
                <div id="authContainer" style="width: 100%;">
                    <button id="loginModalBtn" class="btn btn-primary" style="width: 100%; border-radius: 0.5rem;"><i
                            class="fa-solid fa-user-lock"></i> Login / Register</button>
                    <div id="loggedInUser" class="hidden"
                        style="display: flex; align-items: center; justify-content: space-between; width: 100%; padding: 0.75rem; background: #e2e8f0; border-radius: 0.5rem;">
                        <span style="font-weight: 500; font-size: 0.875rem; color: #334155;"><i
                                class="fa-solid fa-user-check"></i> <span id="usernameDisplay"></span></span>
                        <button id="logoutBtn"
                            style="background: none; border: none; color: #dc2626; cursor: pointer;"><i
                                class="fa-solid fa-right-from-bracket"></i></button>
                    </div>
                </div>
                <div style="font-size: 0.75rem; color: var(--text-muted); text-align: center; width: 100%;">
                    <span id="systemModeText">Guest Mode</span>
                </div>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <header>
                <h1 id="pageTitle">Lab Report Intelligence</h1>
                <p id="pageSubtitle">Upload your lab report for instant analysis and AI-powered insights.</p>
            </header>

            <!-- Upload Section -->
            <section class="upload-section" id="uploadSection">
                <div id="languageSelectorContainer" class="hidden"
                    style="margin-bottom: 2rem; width: 100%; max-width: 600px; text-align: left;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Select Delivery
                        Language</label>
                    <select id="languageSelect" class="form-control"
                        style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid var(--border-color);">
                        <option value="English">English</option>
                        <option value="Hindi">Hindi</option>
                        <option value="Telugu">Telugu</option>
                    </select>
                </div>

                <div class="dropzone" id="dropzone">
                    <input type="file" id="fileInput" accept=".pdf,.png,.jpg,.jpeg" hidden>
                    <div class="upload-content">
                        <i class="fa-solid fa-cloud-arrow-up upload-icon"></i>
                        <h3>Drag & Drop your document</h3>
                        <p>or click to browse files (PDF, PNG, JPG)</p>
                    </div>
                </div>
            </section>

            <!-- Processing State -->
            <section class="processing-section hidden" id="processingSection">
                <div class="loader">
                    <div class="pulse"></div>
                    <i class="fa-solid fa-microscope text-primary" id="processingIcon"></i>
                </div>
                <h3 id="processingTitle">Analyzing Document...</h3>
                <p id="processingSubtitle">Extracting data, cross-referencing benchmarks, and generating AI insights.
                </p>
            </section>

            <!-- Results Section -->
            <section class="results-section hidden" id="resultsSection">

                <!-- Action Buttons -->
                <div class="actions">
                    <button class="btn btn-outline" id="resetBtn">
                        <i class="fa-solid fa-rotate-left"></i> Process Another
                    </button>
                    <button class="btn btn-primary" onclick="window.print()">
                        <i class="fa-solid fa-print"></i> Print
                    </button>
                </div>

                <!-- Prescription Results -->
                <div id="prescriptionResults" class="hidden">
                    <div class="card highlight-card">
                        <div class="card-header" style="justify-content: space-between;">
                            <div style="display:flex; align-items:center; gap:0.75rem;">
                                <i class="fa-solid fa-ear-listen" style="color:var(--primary-color)"></i>
                                <h2>Audio Instructions</h2>
                            </div>
                        </div>
                        <div class="card-body" style="text-align: center; background: #fafafa;">
                            <audio id="audioPlayer" controls
                                style="width: 100%; max-width: 400px; margin: 1rem 0;"></audio>
                            <p class="text-muted" style="font-size: 0.875rem;">Listen to the simplified vernacular
                                instructions.</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <i class="fa-solid fa-language"></i>
                            <h2>Vernacular Summary</h2>
                        </div>
                        <div class="card-body prose" id="translatedTextContent">
                            <!-- Translated text injected here -->
                        </div>
                    </div>

                    <div class="card">
                        <div class="card data-card">
                            <div class="card-header">
                                <i class="fa-solid fa-file-signature"></i>
                                <h2>Original Extraction (OCR)</h2>
                            </div>
                            <div class="card-body">
                                <pre id="ocrTextContent"
                                    style="white-space: pre-wrap; font-size: 0.875rem; color: #475569; background: #f8fafc; padding: 1rem; border-radius: 0.5rem;"></pre>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lab Report Results -->
                <div id="labReportResults" class="hidden">
                    <div class="card highlight-card ai-report-card">
                        <div class="card-header">
                            <i class="fa-solid fa-robot"></i>
                            <h2>AI Human-Friendly Summary</h2>
                        </div>
                        <div class="card-body" id="aiReportContent">
                            <!-- AI content injected here -->
                        </div>
                    </div>

                    <div class="results-grid">
                        <div class="card flags-card">
                            <div class="card-header">
                                <i class="fa-solid fa-triangle-exclamation"></i>
                                <h2>Flagged Metrics</h2>
                            </div>
                            <div class="card-body" id="flagsContainer">
                                <!-- Flags injected here -->
                            </div>
                        </div>

                        <div class="card data-card">
                            <div class="card-header">
                                <i class="fa-solid fa-table-list"></i>
                                <h2>Extracted Tables</h2>
                            </div>
                            <div class="card-body" id="tablesContainer">
                                <!-- Tables injected here -->
                            </div>
                        </div>
                    </div>
                </div>

            </section>

            <!-- Trends Section -->
            <section class="trends-section hidden" id="trendsSection">
                <header>
                    <h1>Health Trends</h1>
                    <p>Track your vitals over time based on historical lab reports.</p>
                </header>
                <div id="chartsContainer" class="results-grid" style="grid-template-columns: 1fr;">
                    <!-- Charts injected here -->
                </div>
            </section>

            <!-- Follow-up Dashboard Section -->
            <section class="followup-section hidden" id="followupSection">
                <header>
                    <h1>Patient Follow-up Dashboard</h1>
                    <p>Live post-surgery recovery metrics and automated triage alerts.</p>
                </header>

                <div style="margin-bottom: 2rem; display: flex; flex-wrap: wrap; gap: 1rem;">
                    <button class="btn btn-outline" id="refreshFollowupBtn"><i class="fa-solid fa-arrows-rotate"></i>
                        Refresh Dashboard</button>
                    <button class="btn btn-primary" id="triggerDemoCheckinBtn"><i class="fa-solid fa-paper-plane"></i>
                        Stimulate Check-in (Demo)</button>
                    <button class="btn btn-primary" id="printAdmissionBtn" style="background: var(--primary-color);"><i
                            class="fa-solid fa-print"></i>
                        Print Admission Report</button>
                    <button class="btn btn-primary" id="messageDoctorBtn" style="background: var(--accent-color);"><i
                            class="fa-solid fa-message"></i>
                        Message Doctor</button>
                </div>

                <div class="card">
                    <div class="card-body" id="followupList" style="padding: 0;">
                        <!-- Table injected here -->
                    </div>
                </div>
            </section>

            <!-- History Section -->
            <section class="history-section hidden" id="historySection">
                <header>
                    <h1>Analysis History</h1>
                    <p>Previously processed reports and their summaries.</p>
                </header>
                <div class="card">
                    <div class="card-body" id="historyList">
                        <!-- History items injected here -->
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section class="settings-section hidden" id="settingsSection">
                <header>
                    <h1>Application Settings</h1>
                    <p>Manage your account and app preferences.</p>
                </header>
                <div class="card">
                    <div class="card-body">
                        <form id="settingsForm">
                            <div class="form-group" style="margin-bottom: 1.5rem;">
                                <label
                                    style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Appearance</label>
                                <select name="theme" class="form-control"
                                    style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid var(--border-color);">
                                    <option value="light">Light Mode</option>
                                    <option value="dark">Dark Mode (Coming Soon)</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-bottom: 2rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" name="notifications" checked>
                                    <span>Enable Notifications</span>
                                </label>
                            </div>
                            <button type="submit" class="btn btn-primary">Save Settings</button>
                        </form>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Auth Modal Overlay -->
    <div id="authModalOverlay" class="hidden"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
        <div class="card" style="width: 100%; max-width: 400px; padding: 2rem; position: relative;">
            <button id="closeAuthModal"
                style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; font-size: 1.25rem; cursor: pointer; color: var(--text-muted);"><i
                    class="fa-solid fa-xmark"></i></button>
            <h2 style="margin-top: 0; text-align: center; margin-bottom: 1.5rem;" id="authModalTitle">Login</h2>

            <form id="authForm">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.25rem;">Username</label>
                    <input type="text" id="authUsername" required class="form-control"
                        style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid var(--border-color);">
                </div>
                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.25rem;">Password</label>
                    <input type="password" id="authPassword" required class="form-control"
                        style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid var(--border-color);">
                </div>
                <button type="submit" id="authSubmitBtn" class="btn btn-primary" style="width: 100%;">Login</button>
            </form>

            <div style="text-align: center; margin-top: 1rem; font-size: 0.875rem;">
                <span id="authToggleText">Need an account?</span>
                <a href="#" id="authToggleLink" style="color: var(--primary-color); font-weight: 500;">Register here</a>
            </div>
        </div>
    </div>

    <!-- Messaging Modal Overlay -->
    <div id="messageModal" class="hidden"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1001; display: flex; align-items: center; justify-content: center;">
        <div class="card"
            style="width: 100%; max-width: 500px; height: 600px; display: flex; flex-direction: column; overflow: hidden; position: relative; padding: 0;">
            <div
                style="padding: 1.5rem; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; background: var(--primary-color); color: white;">
                <h3 style="margin: 0;"><i class="fa-solid fa-user-doctor"></i> Message Doctor</h3>
                <button id="closeMessageModal"
                    style="background:none; border:none; color: white; cursor: pointer; font-size: 1.25rem;"><i
                        class="fa-solid fa-xmark"></i></button>
            </div>
            <div id="messageHistory"
                style="flex: 1; overflow-y: auto; padding: 1.5rem; background: #f8fafc; display: flex; flex-direction: column; gap: 1rem;">
                <!-- Messages dynamic -->
            </div>
            <div
                style="padding: 1rem; border-top: 1px solid var(--border-color); display: flex; gap: 0.5rem; background: white;">
                <input type="text" id="messageInput" placeholder="Type your message..." class="form-control"
                    style="flex: 1; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid var(--border-color);">
                <button id="sendMessageBtn" class="btn btn-primary" style="padding: 0 1.5rem;"><i
                        class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <!-- Print Template (Hidden from Screen) -->
    <div id="printTemplate" class="print-only">
        <!-- Decorative Background Elements -->
        <div class="print-bg-1"></div>
        <div class="print-bg-2"></div>

        <!-- Header -->
        <div class="print-header">
            <div class="print-logo">
                <i class="fa-solid fa-heart" style="color: white; font-size: 1.5rem;"></i>
            </div>
            <div>
                <h1 class="print-title">MediConnect</h1>
                <p class="print-subtitle" id="printOrgName">Clinical Admission</p>
            </div>
        </div>

        <!-- Patient Info -->
        <div class="print-patient-info">
            <div style="margin-bottom: 1.5rem;">
                <p class="print-label">Patient Name</p>
                <h2 class="print-name" id="printPatientName">--</h2>
            </div>

            <div class="print-grid-2">
                <div>
                    <p class="print-label">DOB / Age</p>
                    <p class="print-value" id="printDobAge">--</p>
                </div>
                <div>
                    <p class="print-label">Gender</p>
                    <p class="print-value" id="printGender">--</p>
                </div>
                <div>
                    <p class="print-label">Blood Group</p>
                    <div style="display: flex; align-items: center; gap: 0.25rem;">
                        <i class="fa-solid fa-droplet" style="color: #ef4444;"></i>
                        <p class="print-value" style="color: #dc2626;" id="printBloodGroup">--</p>
                    </div>
                </div>
                <div>
                    <p class="print-label">Contact</p>
                    <div style="display: flex; align-items: center; gap: 0.25rem;">
                        <i class="fa-solid fa-phone" style="color: #94a3b8;"></i>
                        <p class="print-value" id="printContact">--</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vitals Summary -->
        <div class="print-vitals-container">
            <h3 class="print-vitals-title">
                <i class="fa-solid fa-wave-square"></i> Admission Vitals
            </h3>
            <div class="print-grid-3">
                <div><span style="color: #94a3b8;">BP:</span> <strong id="printVitalsBp">--</strong></div>
                <div><span style="color: #94a3b8;">HR:</span> <strong id="printVitalsHr">--</strong></div>
                <div><span style="color: #94a3b8;">Temp:</span> <strong id="printVitalsTemp">--</strong></div>
                <div><span style="color: #94a3b8;">Wt:</span> <strong id="printVitalsWt">--</strong></div>
                <div><span style="color: #94a3b8;">SpO2:</span> <strong id="printVitalsSpo2">--</strong></div>
            </div>
        </div>

        <!-- Doctor Info -->
        <div style="margin-top: 1rem; margin-bottom: 1rem;">
            <p class="print-label">Attending Doctor</p>
            <p class="print-value" id="printDoctorName" style="font-size: 1.1rem;">--</p>
        </div>

        <!-- Barcode Footer -->
        <div class="print-footer">
            <div style="display: flex; justify-content: center; margin-bottom: 0.25rem;">
                <svg id="printBarcode"></svg>
            </div>
            <p style="font-size: 0.625rem; color: #94a3b8; margin-top: 0.5rem; margin-bottom: 0;">
                Please present this card at every visit.
            </p>
            <p style="font-size: 0.625rem; color: #cbd5e1; margin-top: 0.25rem; margin-bottom: 0;"
                id="printGeneratedDate">
                Generated on: --
            </p>
        </div>
    </div>

    <!-- Marked.js for parsing markdown from AI response -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- JsBarcode for Patient ID Barcode -->
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
    <script src="/static/app.js"></script>
</body>

</html>